var pkzo={version:"0.0.1"};pkzo.SolidFrag="precision mediump float;\n\n\n\n//uniform sampler2D uTexture;\n\n\n\nvarying vec2 vTexCoord;\n\n\n\nvoid main()\n\n{\n\n    //gl_FragColor = texture2D(uTexture, vTexCoord);\n\n    gl_FragColor = vec4(1, 0, 1, 1);\n\n}",pkzo.SolidVert="attribute vec3 aVertex;\n\nattribute vec2 aTexCoord;\n\n\n\nuniform mat4 uProjection;\n\nuniform mat4 uModelView;\n\n\n\nvarying vec2 vTexCoord;\n\n\n\nvoid main() {\n\n  vTexCoord   = aTexCoord;\n\n  gl_Position = uProjection * uModelView * vec4(aVertex, 1);\n\n}",pkzo.vec2=function(t,e){return new Float32Array("number"==typeof t&&"undefined"==typeof e?[t,t]:"number"==typeof t&&"number"==typeof e?[t,e]:2)},pkzo.vec3=function(t,e,r){return new Float32Array("number"==typeof t&&"undefined"==typeof e&&"undefined"==typeof r?[t,t,t]:"number"==typeof t&&"number"==typeof e&&"number"==typeof r?[t,e,r]:3)},pkzo.vec4=function(t,e,r,o){return new Float32Array("number"==typeof t&&"undefined"==typeof e&&"undefined"==typeof r&&"undefined"==typeof v3?[t,t,t,t]:"number"==typeof t&&"number"==typeof e&&"number"==typeof r&&"number"==typeof v3?[t,e,r,o]:4)},pkzo.add=function(t,e){for(var r=new Float32Array(t.length),o=0;o<t.length;o++)r[o]=t[o]+e[o];return r},pkzo.sub=function(t,e){for(var r=new Float32Array(t.length),o=0;o<t.length;o++)r[o]=t[o]-e[o];return r},pkzo.dot=function(t,e){for(var r=0,o=0;o<t.length;o++)r+=t[o]*e[o];return r},pkzo.cross=function(t,e){var r=new Float32Array(3);return r[0]=t[1]*e[2]-t[2]*e[1],r[1]=t[2]*e[0]-t[0]*e[2],r[2]=t[0]*e[1]-t[1]*e[0],r},pkzo.multVectorScalar=function(t,e){for(var r=new Float32Array(t.length),o=0;o<t.length;o++)r[o]=t[o]*e;return r},pkzo.length=function(t){return Math.sqrt(pkzo.dot(t,t))},pkzo.normalize=function(t){return pkzo.multVectorScalar(t,1/pkzo.length(t))},pkzo.mat2=function(t){if("array"==typeof t){if(4!=t.length)throw new Error("mat2 must be 4 values");return new Float32Array(t)}return new Float32Array("number"==typeof t?[t,0,0,t]:[1,0,0,1])},pkzo.mat3=function(t){if("array"==typeof t){if(9!=t.length)throw new Error("mat3 must be 9 values");return new Float32Array(t)}return new Float32Array("number"==typeof t?[t,0,0,0,t,0,0,0,t]:[1,0,0,0,1,0,0,0,1])},pkzo.mat4=function(t){if("array"==typeof t){if(16!=t.length)throw new Error("mat4 must be 16 values");return new Float32Array(t)}return new Float32Array("number"==typeof t?[t,0,0,0,0,t,0,0,0,0,t,0,0,0,0,t]:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])},pkzo.multMatrix=function(t,e){for(var r=Math.sqrt(t.length),o=new Float32Array(t.length),i=0;r>i;i++)for(var n=0;r>n;n++){for(var a=0,s=0;r>s;s++)a+=t[i*r+s]*e[s*r+n];o[i*r+n]=a}return o},pkzo.radians=function(t){return t*Math.PI/180},pkzo.degrees=function(t){return 180*t/Math.PI},pkzo.ortho=function(t,e,r,o,i,n){var a=e-t,s=o-r,h=n-i,p=pkzo.mat4();return p[0]=2/a,p[1]=0,p[2]=0,p[3]=0,p[4]=0,p[5]=2/s,p[6]=0,p[7]=0,p[8]=0,p[9]=0,p[10]=-2/h,p[11]=0,p[12]=-(t+e)/a,p[13]=-(o+r)/s,p[14]=-(n+i)/h,p[15]=1,p},pkzo.frustum=function(t,e,r,o,i,n){var a=2*i,s=e-t,h=o-r,p=n-i,f=new Float32Array(16);return f[0]=a/s,f[4]=0,f[8]=(e+t)/s,f[12]=0,f[1]=0,f[5]=a/h,f[9]=(o+r)/h,f[13]=0,f[2]=0,f[6]=0,f[10]=(-n-i)/p,f[14]=-a*n/p,f[3]=0,f[7]=0,f[11]=-1,f[15]=0,f},pkzo.perspective=function(t,e,r,o){var i=r*Math.tan(pkzo.radians(t)),n=i*e;return pkzo.frustum(-n,n,-i,i,r,o)},pkzo.translate=function(t,e,r,o){var i=pkzo.mat4(t);return i[12]=t[0]*e+t[4]*r+t[8]*o+t[12],i[13]=t[1]*e+t[5]*r+t[9]*o+t[13],i[14]=t[2]*e+t[6]*r+t[10]*o+t[14],i[15]=t[3]*e+t[7]*r+t[11]*o+t[15],i},pkzo.rotate=function(t,e,r,o,i){var n=pkzo.radians(e),a=Math.cos(n),s=Math.sin(n),h=Math.sqrt(r*r+o*o+i*i),p=r/h,f=o/h,l=i/h,u=p*(1-a),c=f*(1-a),d=l*(1-a),g=pkzo.mat4(1);g[0]=a+u*p,g[1]=0+u*f+s*l,g[2]=0+u*l-s*f,g[4]=0+c*p-s*l,g[5]=a+c*f,g[6]=0+c*l+s*p,g[8]=0+d*p+s*f,g[9]=0+d*f-s*p,g[10]=a+d*l;var m=pkzo.multMatrix(t,g);return m[12]=t[12],m[13]=t[13],m[14]=t[14],m[15]=t[15],m},pkzo.scale=function(t,e,r,o){var i=pkzo.mat4(1);return i[0]=t[0]*e,i[1]=t[1]*e,i[2]=t[2]*e,i[3]=t[3]*e,i[4]=t[4]*r,i[5]=t[5]*r,i[6]=t[6]*r,i[7]=t[7]*r,i[8]=t[8]*o,i[9]=t[9]*o,i[10]=t[10]*o,i[11]=t[11]*o,i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],i},pkzo.Canvas=function(t){this.canvas="string"==typeof t?document.getElementById(t):t,this.canvas.width=this.canvas.clientWidth,this.canvas.height=this.canvas.clientHeight,this.gl=this.canvas.getContext("webgl",{antialias:!0,depth:!0}),this.gl.clearColor(0,0,0,1),this.gl.width=this.canvas.width,this.gl.height=this.canvas.height},pkzo.Canvas.prototype.init=function(t){t&&t.call(this,this.gl)},pkzo.Canvas.prototype.draw=function(t){(this.canvas.width!=this.canvas.clientWidth||this.canvas.height!=this.canvas.clientHeight)&&(this.canvas.width=this.canvas.clientWidth,this.canvas.height=this.canvas.clientHeight,this.gl.width=this.canvas.width,this.gl.height=this.canvas.height),this.gl.viewport(0,0,this.canvas.width,this.canvas.height),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT),t&&t.call(this,this.gl)},pkzo.Texture=function(t,e){this.gl=t,this.url=e,this.image=null,this.loaded=!1,this.load()},pkzo.Texture.prototype.load=function(){this.image=new Image;var t=this;this.image.onload=function(){t.loaded=!0,t.id&&t.sync()},this.image.src=this.url},pkzo.Texture.prototype.upload=function(){this.id=this.gl.createTexture(),this.gl.bindTexture(this.gl.TEXTURE_2D,this.id),this.loaded?this.sync():this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,1,1,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,null)},pkzo.Texture.prototype.sync=function(){this.gl.bindTexture(this.gl.TEXTURE_2D,this.id),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,this.image),this.gl.generateMipmap(this.gl.TEXTURE_2D),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR_MIPMAP_LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.REPEAT),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.REPEAT)},pkzo.Texture.prototype.release=function(){this.gl.deleteTexture(this.id),this.id=null},pkzo.Texture.prototype.bind=function(){this.id||this.upload(),this.gl.bindTexture(this.gl.TEXTURE_2D,this.id)},pkzo.Shader=function(t,e,r){this.gl=t,this.vertexCode=e,this.fragmentCode=r},pkzo.Shader.prototype.compile=function(){var t=this.compileShader(this.gl.VERTEX_SHADER,this.vertexCode),e=this.compileShader(this.gl.FRAGMENT_SHADER,this.fragmentCode),r=this.gl.createProgram();this.gl.attachShader(r,t),this.gl.attachShader(r,e),this.gl.linkProgram(r);var o=this.gl.getProgramInfoLog(r);if(this.gl.getProgramParameter(r,this.gl.LINK_STATUS)===!1)throw new Error(o);""!==o&&console.log(o),this.gl.deleteShader(t),this.gl.deleteShader(e),this.id=r},pkzo.Shader.prototype.compileShader=function(t,e){var r=this.gl.createShader(t);this.gl.shaderSource(r,e),this.gl.compileShader(r);var o=this.gl.getShaderInfoLog(r);if(this.gl.getShaderParameter(r,this.gl.COMPILE_STATUS)===!1)throw new Error(o);return""!==o&&console.log(o),r},pkzo.Shader.prototype.release=function(){this.gl.deleteProgram(id)},pkzo.Shader.prototype.bind=function(){this.id||this.compile(),this.gl.useProgram(this.id)},pkzo.Shader.prototype.setArrtibute=function(t,e,r){if(e.bind(),void 0===r)var r=e.elementSize;var o=this.gl.getAttribLocation(this.id,t);this.gl.enableVertexAttribArray(o),this.gl.vertexAttribPointer(o,r,e.elementType,this.gl.FALSE,0,0)},pkzo.Shader.prototype.setUniform1i=function(t,e){var r=this.gl.getUniformLocation(this.id,t);this.gl.uniform1i(r,e)},pkzo.Shader.prototype.setUniform1f=function(t,e){var r=this.gl.getUniformLocation(this.id,t);this.gl.uniform1f(r,e)},pkzo.Shader.prototype.setUniform2fv=function(t,e){var r=this.gl.getUniformLocation(this.id,t);this.gl.uniform2f(r,e[0],e[1])},pkzo.Shader.prototype.setUniform3fv=function(t,e){var r=this.gl.getUniformLocation(this.id,t);this.gl.uniform3f(r,e[0],e[1],e[2])},pkzo.Shader.prototype.setUniform4fv=function(t,e){var r=this.gl.getUniformLocation(this.id,t);this.gl.uniform4f(r,e[0],e[1],e[2],e[4])},pkzo.Shader.prototype.setUniformMatrix4fv=function(t,e,r){if(void 0===r||null===r)var r=!1;var o=this.gl.getUniformLocation(this.id,t);this.gl.uniformMatrix4fv(o,r,e)},pkzo.Scene=function(){},pkzo.Scene.prototype.add=function(t){this.entities?this.entities.push(t):this.entities=[t]},pkzo.Mesh=function(){},pkzo.Mesh.box=function(t){var e=new pkzo.Mesh;return e.vertices=[t[0],t[1],t[2],-t[0],t[1],t[2],-t[0],-t[1],t[2],t[0],-t[1],t[2],t[0],t[1],t[2],t[0],-t[1],t[2],t[0],-t[1],-t[2],t[0],t[1],-t[2],t[0],t[1],t[2],t[0],t[1],-t[2],-t[0],t[1],-t[2],-t[0],t[1],t[2],-t[0],t[1],t[2],-t[0],t[1],-t[2],-t[0],-t[1],-t[2],-t[0],-t[1],t[2],-t[0],-t[1],-t[2],t[0],-t[1],-t[2],t[0],-t[1],t[2],-t[0],-t[1],t[2],t[0],-t[1],-t[2],-t[0],-t[1],-t[2],-t[0],t[1],-t[2],t[0],t[1],-t[2]],e.normals=[0,0,1,0,0,1,0,0,1,0,0,1,1,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1],e.texCoords=[1,1,0,1,0,0,1,0,0,1,0,0,1,0,1,1,1,0,1,1,0,1,0,0,1,1,0,1,0,0,1,0,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1],e.indices=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23],e},pkzo.Mesh.load=function(t){var e=new pkzo.Mesh;return e},pkzo.Mesh.prototype.upload=function(t){this.vertexBuffer=new pkzo.Buffer(t,this.vertices,t.ARRAY_BUFFER,t.FLOAT),this.normalBuffer=new pkzo.Buffer(t,this.normals,t.ARRAY_BUFFER,t.FLOAT),this.texCoordBuffer=new pkzo.Buffer(t,this.texCoords,t.ARRAY_BUFFER,t.FLOAT),this.indexBuffer=new pkzo.Buffer(t,this.indices,t.ELEMENT_ARRAY_BUFFER,t.UNSIGNED_SHORT)},pkzo.Mesh.prototype.draw=function(t,e){this.vertexBuffer||this.upload(t),this.shader.setArrtibute("aVertex",this.vertexBuffer,3),this.shader.setArrtibute("aNormal",this.normalBuffer,3),this.shader.setArrtibute("aTexCoord",this.texCoordBuffer,2),this.indexBuffer.draw(t.TRIANGLES)},pkzo.Mesh.prototype.release=function(){this.vertexBuffer.release(),delete this.vertexBuffer,this.normalBuffer.release(),delete this.normalBuffer,this.texCoordBuffer.release(),delete this.texCoordBuffer,this.indexBuffer.release(),delete this.indexBuffer},pkzo.Material=function(){},pkzo.Material.prototype.setup=function(t,e){},pkzo.Entity=function(){this.transform=pkzo.mat4(1)},pkzo.Entity.prototype.getXVector=function(){return pkzo.vec3(this.transform[0],this.transform[1],this.transform[2])},pkzo.Entity.prototype.getYVector=function(){return pkzo.vec3(this.transform[4],this.transform[5],this.transform[6])},pkzo.Entity.prototype.getZVector=function(){return pkzo.vec3(this.transform[8],this.transform[9],this.transform[10])},pkzo.Entity.prototype.getPosition=function(){return pkzo.vec3(this.transform[12],this.transform[13],this.transform[14])},pkzo.Entity.prototype.setPosition=function(t){this.transform[12]=t[0],this.transform[13]=t[1],this.transform[14]=t[2]},pkzo.Entity.prototype.lookAt=function(t,e){var r=this.getPosition(),o=pkzo.normalize(pkzo.sub(t,r)),i=pkzo.normalize(pkzo.cross(o,e)),n=pkzo.normalize(pkzo.cross(i,o));this.transform[0]=i[0],this.transform[1]=i[1],this.transform[2]=i[2],this.transform[4]=n[0],this.transform[5]=n[1],this.transform[6]=n[2],this.transform[8]=o[0],this.transform[9]=o[1],this.transform[10]=o[2]},pkzo.Camera=function(t){pkzo.Entity.call(this);var e=t?t:{};this.yfov=e.yfov?e.yfov:45,this.znear=e.znear?e.znear:.1,this.zfar=e.zfar?e.zfar:100,this.aspect=1},pkzo.Camera.prototype=Object.create(pkzo.Entity.prototype),pkzo.Camera.prototype.constructor=pkzo.Camera,pkzo.Camera.prototype.update=function(){this.projectionMatrix=pkzo.perspective(this.yfov,this.aspect,this.znear,this.zfar),this.viewMatrix=pkzo.mat4(1),this.normalMatrix=pkzo.mat3(1)},pkzo.Object=function(t,e){pkzo.Entity.call(this),this.mesh=t,this.material=e},pkzo.Object.prototype=Object.create(pkzo.Entity.prototype),pkzo.Object.prototype.constructor=pkzo.Object,pkzo.Object.prototype.draw=function(t,e){this.material.setup(t,e),this.mesh.drtaw(t,e)},pkzo.Renderer=function(t){this.canvas=new pkzo.Canvas(t);var e=this;this.canvas.init(function(t){e.solidShader=new pkzo.Shader(pkzo.SolidVert,pkzo.SolidFrag)})},pkzo.Renderer.prototype.render=function(t,e){var r=this;this.canvas.draw(function(o){var i=r.solidShader;i.bind(),e.apsect=o.width/o.height,e.update(),i.setUniformMatrix4fv("uProjectionMatrix",e.projectionMatrix),i.setUniformMatrix3fv("uNormalMatrix",e.normalMatrix);pkzo.mat4(e.viewMatrix);i.setUniformMatrix4fv("uModelViewMatrix",modelView),t.entities&&t.entities.forEach(function(t){t.draw&&t.draw(o,i)})})};